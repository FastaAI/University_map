<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  <title>ì „êµ­ì˜ ëŒ€í•™êµ ìœ„ì¹˜ ì‹œê°í™”</title>

  <style>
    /* =========================
       âœ… PC/ê¸°ì¡´ í™”ë©´: ì ˆëŒ€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ (ì‚¬ìš©ì ì›ë³¸ ê·¸ëŒ€ë¡œ)
       ========================= */
    body { font-family: system-ui, AppleSDGothicNeo, Pretendard, sans-serif; margin:0; background:#f7f7f8; }
    header { background:#111827; color:#fff; padding:14px 18px; }
    header h1 { margin:0; font-size:18px; }
    main { padding:16px; display:grid; grid-template-columns:360px 1fr; gap:16px; }
    .panel { background:#fff; border-radius:14px; padding:14px; box-shadow:0 2px 10px rgba(0,0,0,.06); }
    label { font-size:12px; color:#6b7280; display:block; margin-bottom:6px; }
    input, select { width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; }
    button { margin-top:10px; width:100%; padding:10px 12px; background:#111827; color:#fff; border:0; border-radius:10px; cursor:pointer; font-weight:800; }
    button:hover { opacity:.95; }
    .map { min-height:560px; height: calc(100vh - 140px); }
    .msg { margin-top:10px; font-size:13px; background:#f1f5f9; border-radius:10px; padding:10px; }

    .section-title { font-weight:900; font-size:14px; margin:12px 0 8px; }
    .btn-ghost { background:#334155; }

    .tabs { display:flex; gap:8px; margin-bottom:12px; }
    .tab-btn {
      flex:1; padding:10px 12px; border:1px solid #e5e7eb; background:#fff;
      cursor:pointer; border-radius:12px; font-weight:900; color:#111827;
    }
    .tab-btn.active { border-color:#111827; }
    .tab-pane { display:none; }
    .tab-pane.active { display:block; }

    .suggest {
      list-style:none; padding:0; margin-top:6px;
      border:1px solid #e5e7eb; border-radius:10px; background:#fff;
      max-height:180px; overflow:auto; display:none; position:relative; z-index:9999;
    }
    .suggest li { padding:8px 12px; cursor:pointer; }
    .suggest li:hover { background:#f3f4f6; }

    .box { margin-top:12px; border:1px solid #e5e7eb; border-radius:14px; padding:12px; background:#fafafa; }
    .grid { display:grid; grid-template-columns:1fr; gap:8px; }
    .row { display:flex; gap:8px; align-items:center; }
    .small { font-size:12px; color:#6b7280; }

    .chip-wrap { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
    .chip { border:1px solid #e5e7eb; background:#fff; border-radius:999px; padding:8px 10px; font-size:12px; cursor:pointer; user-select:none; }
    .chip:hover { background:#f8fafc; }
    .chip .x { margin-left:8px; font-weight:900; color:#64748b; }

    .icon-btn {
      width:44px; height:44px; margin-top:0; border-radius:12px;
      background:#fff; color:#111827; border:1px solid #e5e7eb; font-weight:900; cursor:pointer;
    }

    .cards { display:grid; grid-template-columns:1fr; gap:10px; margin-top:10px; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:12px; }
    .card .title { font-weight:900; margin-bottom:6px; }
    .kv { font-size:13px; color:#111827; line-height:1.4; }
    .kv span { color:#6b7280; }

    .chat-box {
      height:360px; border:1px solid #e5e7eb; border-radius:12px; padding:10px;
      overflow-y:auto; background:#fafafa;
    }
    .chat-msg { margin:8px 0; line-height:1.35; font-size:14px; white-space:pre-wrap; word-break:break-word; }
    .chat-msg.user { text-align:right; }
    .chat-msg .bubble { display:inline-block; padding:8px 10px; border-radius:12px; max-width:92%; }
    .chat-msg.user .bubble { background:#e8f0ff; }
    .chat-msg.bot .bubble { background:#fff; border:1px solid #eee; }
    .chat-input-row { display:flex; gap:8px; margin-top:10px; }
    .chat-input-row input { flex:1; margin-top:0; }
    .chat-input-row button { width:auto; margin-top:0; padding:10px 14px; border-radius:12px; }

    .action-row { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
    .action-btn {
      width:auto; margin-top:0; padding:8px 10px; border-radius:12px;
      border:1px solid #e5e7eb; background:#fff; color:#111827; cursor:pointer; font-weight:900;
    }
    .action-btn:hover { background:#f8fafc; }

    /* ===== PC ê³ ì • 2ì—´ ì ê¸ˆ ===== */
    @media (min-width: 769px) {
      main { grid-template-columns: 360px 1fr !important; }
    }
    @media (min-width: 1024px) {
      main { grid-template-columns: 360px 1fr !important; }
    }

    /* =========================================================
       âœ… ëª¨ë°”ì¼ ë°”í…€ì‹œíŠ¸ + â€œë¹ˆ ê³µê°„ 0â€ ì§€ë„ í™•ì¥ (ìµœì¢… ë®ì–´ì“°ê¸°)
       ========================================================= */
    @media (max-width: 768px) {
      html, body { height: 100%; }

      :root{
        --sheet-h: 96px;   /* JSê°€ ì‹¤ì¸¡ìœ¼ë¡œ ê°±ì‹  */
        --header-h: 56px;  /* JSê°€ ì‹¤ì¸¡ìœ¼ë¡œ ê°±ì‹  */
        --sheet-gap: 10px;
        --avail-h: 60dvh;  /* JSê°€ ì‹¤ì¸¡ìœ¼ë¡œ ê°±ì‹  */
      }

      main { padding: 0 !important; gap: 0 !important; grid-template-columns: 1fr !important; }

      #mapPanel {
        border-radius: 0 !important;
        box-shadow: none !important;
        padding: 0 !important;
        background: transparent !important;

        /* âœ… ì§€ë„ íŒ¨ë„ ìì²´ë¥¼ â€œë‚¨ëŠ” í™”ë©´ ë†’ì´â€ë¡œ ê³ ì • */
        height: var(--avail-h) !important;
      }

      /* âœ… ì»¨í…Œì´ë„ˆë„ íŒ¨ë„ ë†’ì´ë¥¼ 100% ê½‰ ì±„ì›€ */
      #map-container {
        height: 100% !important;
        min-height: 0 !important;
      }

      /* âœ… Folium/Leaflet ë‚´ë¶€ë„ 100% ê°•ì œ (ì—¬ê¸°ì„œ ë¹ˆ ê³µê°„ ì œê±°ë¨) */
      #map-container > div,
      #map-container .folium-map,
      #map-container .leaflet-container,
      #map-container iframe {
        height: 100% !important;
        width: 100% !important;
        border: 0 !important;
      }

      /* ë°”í…€ì‹œíŠ¸ */
      #toolPanel{
        position: fixed;
        left: 10px;
        right: 10px;
        bottom: 10px;
        z-index: 2000;
        border-radius: 18px;
        box-shadow: 0 18px 45px rgba(0,0,0,.18);
        padding: 10px 10px 12px;
        background: rgba(255,255,255,.96);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        overflow: hidden;
      }

      .sheet-head{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:10px;
        padding: 6px 6px 10px;
      }

      .grab{
        width:44px;
        height:5px;
        border-radius:999px;
        background:#e5e7eb;
        flex:0 0 auto;
      }

      .sheet-title{
        font-weight:900;
        font-size:13px;
        color:#111827;
        opacity:.9;
        flex:1;
        min-width: 70px;
      }

      .sheet-btns{
        display:flex;
        gap:6px;
        flex:0 0 auto;
        flex-wrap:wrap;
        justify-content:flex-end;
      }
      .sheet-btn{
        margin-top:0;
        width:auto;
        padding:8px 9px;
        border-radius:12px;
        border:1px solid #e5e7eb;
        background:#fff;
        color:#111827;
        font-weight:900;
        font-size:12px;
        line-height:1;
        white-space:nowrap;
      }

      .sheet-body{
        overflow:auto;
        -webkit-overflow-scrolling:touch;
        padding: 0 6px 6px;
      }

      #toolPanel.sheet-mini  .sheet-body { max-height: 0; padding-bottom: 0; overflow: hidden; }
      #toolPanel.sheet-mid   .sheet-body { max-height: 34dvh; }
      #toolPanel.sheet-full  .sheet-body { max-height: 68dvh; }

      /* í„°ì¹˜ í¸ì˜ */
      input, select, button { font-size: 16px; }
      .tab-btn{ padding:11px 10px; border-radius:14px; }
      button{ border-radius:14px; }
      .icon-btn{ width:46px; height:46px; border-radius:14px; }

      body{ padding-bottom: 120px; }
    }
  </style>
</head>

<body>
  <header id="pageHeader"><h1>ì „êµ­ì˜ ëŒ€í•™êµ ìœ„ì¹˜ ì‹œê°í™”</h1></header>

  <main>
    <section class="panel" id="toolPanel">
      <div class="sheet-head" id="sheetHead" style="display:none;">
        <div class="grab" aria-hidden="true"></div>
        <div class="sheet-title">ê²€ìƒ‰/AI íŒ¨ë„</div>
        <div class="sheet-btns">
          <button class="sheet-btn" id="sheetMini" type="button">ë¯¸ë‹ˆ</button>
          <button class="sheet-btn" id="sheetMid" type="button">ì¤‘ê°„</button>
          <button class="sheet-btn" id="sheetFull" type="button">í’€</button>
        </div>
      </div>

      <div class="sheet-body" id="sheetBody">
        <div class="tabs">
          <button id="tabBtnTools" class="tab-btn active" type="button">ğŸ—ºï¸ ê²€ìƒ‰</button>
          <button id="tabBtnChat" class="tab-btn" type="button">ğŸ’¬ AI ë„ìš°ë¯¸</button>
        </div>

        <div id="tabTools" class="tab-pane active">
          <div class="section-title">ğŸ” ê¸°ë³¸ ê²€ìƒ‰</div>
          <form id="searchForm2D" method="get" action="/search" autocomplete="off">
            <label for="search-input">í•™êµëª… ì…ë ¥</label>
            <div class="row">
              <input id="search-input" type="text" name="name" value="{{ search or '' }}" placeholder="ì˜ˆ: ì„œ / ì„œìš¸ëŒ€ / ì—°ëŒ€ / í•œì–‘ëŒ€"/>
              <button id="favAddBtn" class="icon-btn" type="button" title="ì¦ê²¨ì°¾ê¸° ì¶”ê°€">â˜…</button>
            </div>
            <ul id="suggest-list" class="suggest"></ul>
            <button type="submit">2D ì§€ë„ì—ì„œ ë³´ê¸°</button>
          </form>

          <form id="searchForm3D" method="get" action="/3d" style="margin-top:8px;">
            <input id="search-hidden-3d" type="hidden" name="name" value="{{ search or '' }}">
            <button type="submit" class="btn-ghost">ğŸŒ 3D(ë¸Œì´ì›”ë“œ)ë¡œ ë³´ê¸°</button>
          </form>

          <div class="box" style="background:#fff;">
            <div class="section-title" style="margin-top:0;">ğŸ•˜ ìµœê·¼ ê²€ìƒ‰</div>
            <div id="recentWrap" class="chip-wrap"></div>

            <div class="section-title">â­ ì¦ê²¨ì°¾ê¸°</div>
            <div id="favWrap" class="chip-wrap"></div>
          </div>

          <div class="box">
            <div class="section-title" style="margin-top:0;">ğŸ“ ì£¼ë³€ ëŒ€í•™ ì°¾ê¸°</div>
            <form id="nearForm" method="get" action="/nearby" autocomplete="off">
              <div class="grid">
                <div>
                  <label for="near-name">ê¸°ì¤€ í•™êµ</label>
                  <input id="near-name" type="text" name="name" value="{{ near_name or '' }}" placeholder="ì˜ˆ: ì„œìš¸ëŒ€"/>
                  <ul id="near-suggest" class="suggest"></ul>
                </div>
                <div>
                  <label for="near-radius">ë°˜ê²½ (km)</label>
                  <input id="near-radius" type="number" min="1" max="50" step="1" name="radius_km" value="{{ near_radius or '5' }}">
                </div>
                <button type="submit">ë°˜ê²½ ë‚´ ëŒ€í•™ ì§€ë„ì— í‘œì‹œ</button>
              </div>

              <button id="geoNearBtn" type="button" class="btn-ghost" style="margin-top:8px;">
                ğŸ“ ë‚´ ìœ„ì¹˜ë¡œ ì£¼ë³€ ëŒ€í•™ ì°¾ê¸°
              </button>
            </form>
          </div>

          {% if message %}
            <div class="msg">{{ message }}</div>
          {% endif %}
        </div>

        <div id="tabChat" class="tab-pane">
          <div class="section-title">ğŸ’¬ Gemini ìƒë‹´</div>
          <div class="chat-box" id="chatBox"></div>

          <div class="chat-input-row">
            <input id="chatInput" type="text" placeholder="ì˜ˆ) ì•ˆë…•! ì œë¯¸ë‚˜ì´!" />
            <button id="chatSend" type="button">Send</button>
          </div>

          <div class="small" style="margin-top:10px;">
            ë‹µë³€ ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ 2D/3D ë°”ë¡œ ì´ë™ ê°€ëŠ¥. (GEMINI_API_KEY í•„ìš”)
          </div>
        </div>
      </div>
    </section>

    <section class="panel" id="mapPanel">
      <div class="map" id="map-container">
        {% if map %}
          {{ map | safe }}
        {% else %}
          <div class="msg">ì™¼ìª½ì—ì„œ ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ë©´ ì§€ë„ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
        {% endif %}
      </div>
    </section>
  </main>

  <script>
    // Tabs
    const tabBtnTools = document.getElementById("tabBtnTools");
    const tabBtnChat  = document.getElementById("tabBtnChat");
    const tabTools    = document.getElementById("tabTools");
    const tabChat     = document.getElementById("tabChat");

    function setActive(which){
      const tools = which === "tools";
      tabBtnTools.classList.toggle("active", tools);
      tabBtnChat.classList.toggle("active", !tools);
      tabTools.classList.toggle("active", tools);
      tabChat.classList.toggle("active", !tools);
    }
    tabBtnTools.addEventListener("click", ()=>setActive("tools"));
    tabBtnChat.addEventListener("click",  ()=>setActive("chat"));

    // LocalStorage keys
    const RECENT_KEY = "uni_recent_search_v1";
    const FAV_KEY    = "uni_favorites_v1";
    const CHAT_KEY   = "uni_chat_history_v2";

    function safeJsonParse(v, fb){ try { return JSON.parse(v); } catch { return fb; } }
    function loadList(key){ return safeJsonParse(localStorage.getItem(key) || "[]", []); }
    function saveList(key, arr){ localStorage.setItem(key, JSON.stringify(arr)); }
    function pushUnique(key, value, maxLen=12){
      value = (value || "").trim();
      if(!value) return;
      let arr = loadList(key).filter(x => x !== value);
      arr.unshift(value);
      if(arr.length > maxLen) arr = arr.slice(0, maxLen);
      saveList(key, arr);
    }
    function removeItem(key, value){ saveList(key, loadList(key).filter(x => x !== value)); }

    async function fetchSuggest(q){
      const res = await fetch(`/suggest?query=${encodeURIComponent(q)}`);
      if(!res.ok) return [];
      const data = await res.json();
      return data.suggestions || [];
    }
    function clearSuggest(ul){ ul.innerHTML = ""; ul.style.display = "none"; }
    async function handleSuggest(inputEl, ulEl, onPick){
      const q = inputEl.value.trim();
      if(!q){ clearSuggest(ulEl); return; }
      const items = await fetchSuggest(q);
      ulEl.innerHTML = "";
      items.forEach(name=>{
        const li=document.createElement("li");
        li.textContent=name;
        li.addEventListener("click", ()=>{ onPick(name); clearSuggest(ulEl); });
        ulEl.appendChild(li);
      });
      ulEl.style.display = items.length ? "block" : "none";
    }

    const input    = document.getElementById("search-input");
    const list     = document.getElementById("suggest-list");
    const hidden3d = document.getElementById("search-hidden-3d");
    const favAddBtn= document.getElementById("favAddBtn");
    function syncHidden3D(){ hidden3d.value = input.value || ""; }

    input.addEventListener("input", syncHidden3D);
    input.addEventListener("input", ()=>handleSuggest(input, list, (name)=>{ input.value=name; syncHidden3D(); }));
    document.addEventListener("click", (e)=>{ if(e.target !== input && !list.contains(e.target)) clearSuggest(list); });

    const recentWrap = document.getElementById("recentWrap");
    const favWrap    = document.getElementById("favWrap");
    function makeChip(text, {onClick, onRemove}={}){
      const chip=document.createElement("div");
      chip.className="chip";
      chip.textContent=text;
      if(onRemove){
        const x=document.createElement("span");
        x.className="x";
        x.textContent="Ã—";
        x.addEventListener("click",(ev)=>{ ev.stopPropagation(); onRemove(); });
        chip.appendChild(x);
      }
      if(onClick) chip.addEventListener("click", onClick);
      return chip;
    }
    function renderRecent(){
      recentWrap.innerHTML="";
      const items=loadList(RECENT_KEY);
      if(!items.length){ recentWrap.appendChild(makeChip("ìµœê·¼ ê²€ìƒ‰ ì—†ìŒ")); return; }
      items.forEach(q=>recentWrap.appendChild(makeChip(q,{onClick:()=>{ input.value=q; syncHidden3D(); input.focus(); }})));
    }
    function renderFavs(){
      favWrap.innerHTML="";
      const items=loadList(FAV_KEY);
      if(!items.length){ favWrap.appendChild(makeChip("ì¦ê²¨ì°¾ê¸° ì—†ìŒ")); return; }
      items.forEach(q=>favWrap.appendChild(makeChip(q,{
        onClick:()=>{ input.value=q; syncHidden3D(); input.focus(); },
        onRemove:()=>{ removeItem(FAV_KEY,q); renderFavs(); }
      })));
    }
    renderRecent(); renderFavs();

    document.getElementById("searchForm2D").addEventListener("submit", ()=>{ pushUnique(RECENT_KEY, input.value); renderRecent(); });
    document.getElementById("searchForm3D").addEventListener("submit", ()=>{ pushUnique(RECENT_KEY, hidden3d.value || input.value); renderRecent(); });
    favAddBtn.addEventListener("click", ()=>{
      const q=(input.value||"").trim();
      if(!q) return;
      pushUnique(FAV_KEY, q, 50);
      renderFavs();
    });

    const nearName=document.getElementById("near-name");
    const nearS=document.getElementById("near-suggest");
    nearName.addEventListener("input", ()=>handleSuggest(nearName, nearS, (name)=>{ nearName.value=name; }));
    document.addEventListener("click",(e)=>{
      if(e.target !== nearName && !nearS.contains(e.target)) clearSuggest(nearS);
    });

    // Geo Nearby
    const geoBtn = document.getElementById("geoNearBtn");
    const nearRadiusInput = document.getElementById("near-radius");
    if (geoBtn) {
      geoBtn.addEventListener("click", () => {
        const radius = (nearRadiusInput && nearRadiusInput.value) ? nearRadiusInput.value : "5";
        if (!navigator.geolocation) { alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŒ ğŸ˜¢"); return; }
        geoBtn.disabled = true;
        geoBtn.textContent = "ğŸ“¡ ìœ„ì¹˜ í™•ì¸ ì¤‘...";
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            window.location.href = `/nearby_geo?lat=${encodeURIComponent(lat)}&lng=${encodeURIComponent(lng)}&radius_km=${encodeURIComponent(radius)}`;
          },
          (err) => {
            geoBtn.disabled = false;
            geoBtn.textContent = "ğŸ“ ë‚´ ìœ„ì¹˜ë¡œ ì£¼ë³€ ëŒ€í•™ ì°¾ê¸°";
            if (err.code === 1) alert("ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë¨. ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ ì˜† ğŸ”’ì—ì„œ í—ˆìš©í•´ì¤˜!");
            else alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆì–´. (GPS/ê¶Œí•œ/ë„¤íŠ¸ì›Œí¬ í™•ì¸)");
          },
          { enableHighAccuracy:true, timeout:8000, maximumAge:10000 }
        );
      });
    }

    /* âœ… ë°”í…€ì‹œíŠ¸ + â€œë‚¨ëŠ” ê³µê°„ = ì§€ë„â€ ê³„ì‚° */
    const toolPanel  = document.getElementById("toolPanel");
    const sheetHead  = document.getElementById("sheetHead");
    const sheetMini  = document.getElementById("sheetMini");
    const sheetMid   = document.getElementById("sheetMid");
    const sheetFull  = document.getElementById("sheetFull");
    const headerEl   = document.getElementById("pageHeader");

    function isMobileNow(){ return window.matchMedia("(max-width: 768px)").matches; }

    function updateVars(){
      if(!isMobileNow()) return;

      const hRect = headerEl.getBoundingClientRect();
      const pRect = toolPanel.getBoundingClientRect();

      const headerH = Math.max(44, Math.round(hRect.height));
      const sheetH  = Math.max(70, Math.round(pRect.height));
      const gap = 10; // sheet-gap(ì•„ë˜ìª½ 10px)

      document.documentElement.style.setProperty("--header-h", headerH + "px");
      document.documentElement.style.setProperty("--sheet-h", sheetH + "px");

      // âœ… ì‹¤ì œ ë‚¨ëŠ” ë†’ì´ = í™”ë©´ - í—¤ë” - ì‹œíŠ¸ - gap
      const avail = Math.max(200, Math.round(window.innerHeight - headerH - sheetH - gap));
      document.documentElement.style.setProperty("--avail-h", avail + "px");
    }

    function updateVarsSoon(){
      requestAnimationFrame(updateVars);
      setTimeout(updateVars, 50);
      setTimeout(updateVars, 160);
      setTimeout(updateVars, 320);
    }

    function setSheetMode(mode){
      toolPanel.classList.remove("sheet-mini","sheet-mid","sheet-full");
      toolPanel.classList.add(mode);
      localStorage.setItem("uni_sheet_mode_v1", mode);
      updateVarsSoon();
      // leaflet ì¬ê³„ì‚° íŠ¸ë¦¬ê±°(ëŒ€ë¶€ë¶„ì€ cssë¡œ í•´ê²°ë˜ì§€ë§Œ ì•ˆì „ë¹µ)
      window.dispatchEvent(new Event("resize"));
    }

    function applyMobileSheetUI(){
      if(!isMobileNow()){
        sheetHead.style.display = "none";
        toolPanel.classList.remove("sheet-mini","sheet-mid","sheet-full");
        return;
      }
      sheetHead.style.display = "flex";
      const saved = localStorage.getItem("uni_sheet_mode_v1");
      if(saved === "sheet-mini" || saved === "sheet-mid" || saved === "sheet-full") setSheetMode(saved);
      else setSheetMode("sheet-mid");
      updateVarsSoon();
    }

    // ResizeObserverë¡œ ë‚´ë¶€ ì½˜í…ì¸  ëŠ˜ì–´ë‚˜ëŠ” ê²ƒë„ ì¦‰ì‹œ ë°˜ì˜
    const ro = new ResizeObserver(()=>updateVarsSoon());
    ro.observe(toolPanel);
    ro.observe(headerEl);

    toolPanel.addEventListener("transitionend", ()=>updateVarsSoon());
    window.addEventListener("resize", ()=>{ applyMobileSheetUI(); updateVarsSoon(); });

    if(sheetMini) sheetMini.addEventListener("click", ()=>setSheetMode("sheet-mini"));
    if(sheetMid)  sheetMid.addEventListener("click",  ()=>setSheetMode("sheet-mid"));
    if(sheetFull) sheetFull.addEventListener("click", ()=>setSheetMode("sheet-full"));

    applyMobileSheetUI();
    updateVarsSoon();
  </script>
</body>
</html>
